<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<!-- author : scj date : 2017-06-27 10:02:37 version : 1.0 -->
<mapper namespace="com.jinpaihushi.jphs.goods.dao.GoodsDao">

	<sql id="field">
		G.id, G.product_id, G.title, G.sub_title,
		G.content, G.tijian_type_id, G.tijian_hospital_id, G.tool,
		G.insurance, G.must, G.type, G.grade_type, G.sort, G.remark,
		G.status, G.create_time, G.creator_id, G.creator_name
	</sql>

	<sql id="fieldGlobal">
		G.id G_id, G.product_id G_product_id,
		G.title G_title, G.sub_title G_sub_title,
		G.content G_content, G.tijian_type_id G_tijian_type_id,
		G.tijian_hospital_id G_tijian_hospital_id, G.tool G_tool,
		G.insurance G_insurance,G.must G_must, G.type G_type, G.grade_type G_grade_type,
		G.sort G_sort, G.remark G_remark,
		G.status G_status, G.create_time G_create_time,
		G.creator_id G_creator_id, G.creator_name G_creator_name
	</sql>

	<sql id="fieldWithAlias">
		G.id id, G.product_id productId,
		G.title title, G.sub_title subTitle,
		G.content content, G.tijian_type_id tijianTypeId,
		G.tijian_hospital_id tijianHospitalId, G.tool tool,
		G.insurance insurance,G.must must, G.type type, G.grade_type gradeType,
		G.sort
		sort, G.remark remark,
		G.status status, G.create_time createTime,
		G.creator_id creatorId, G.creator_name creatorName
	</sql>

	<sql id="condition">
		<if test="id!=null and id!=''">
			AND G.id=#{id}
		</if>
		<if test="productId!=null and productId!=''">
			AND G.product_id=#{productId}
		</if>
		<if test="title!=null and title!=''">
			AND G.title=#{title}
		</if>
		<if test="subTitle!=null and subTitle!=''">
			AND G.sub_title=#{subTitle}
		</if>
		<if test="content!=null and content!=''">
			AND G.content=#{content}
		</if>
		<if test="tijianTypeId!=null and tijianTypeId!=''">
			AND G.tijian_type_id=#{tijianTypeId}
		</if>
		<if test="tijianHospitalId!=null and tijianHospitalId!=''">
			AND G.tijian_hospital_id=#{tijianHospitalId}
		</if>
		<if test="tool!=null">
			AND G.tool=#{tool}
		</if>
		<if test="insurance!=null">
			AND G.insurance=#{insurance}
		</if>
		<if test="must!=null">
			AND G.must=#{must}
		</if>
		<if test="type!=null">
			AND G.type=#{type}
		</if>
		<if test="gradeType!=null">
			AND G.grade_type=#{gradeType}
		</if>
		<if test="sort!=null">
			AND G.sort=#{sort}
		</if>
		<if test="remark!=null and remark!=''">
			AND G.remark=#{remark}
		</if>
		<if test="status!=null">
			AND G.status=#{status}
		</if>
		<if test="createTime!=null">
			AND G.create_time=#{createTime}
		</if>
		<if test="creatorId!=null and creatorId!=''">
			AND G.creator_id=#{creatorId}
		</if>
		<if test="creatorName!=null and creatorName!=''">
			AND G.creator_name=#{creatorName}
		</if>
	</sql>

	<sql id="dynamicWhere">
		<where>
			<include refid="condition" />
		</where>
	</sql>

	<sql id="queryWhere">
		<where>
			<if test="id!=null and id!=''">
				AND G.id LIKE CONCAT('%', #{id}, '%')
			</if>
			<if test="productId!=null and productId!=''">
				AND G.product_id LIKE CONCAT('%', #{productId}, '%')
			</if>
			<if test="title!=null and title!=''">
				AND G.title LIKE CONCAT('%', #{title}, '%')
			</if>
			<if test="subTitle!=null and subTitle!=''">
				AND G.sub_title LIKE CONCAT('%', #{subTitle}, '%')
			</if>
			<if test="content!=null and content!=''">
				AND G.content LIKE CONCAT('%', #{content}, '%')
			</if>
			<if test="tijianTypeId!=null and tijianTypeId!=''">
				AND G.tijian_type_id LIKE CONCAT('%', #{tijianTypeId},
				'%')
			</if>
			<if test="tijianHospitalId!=null and tijianHospitalId!=''">
				AND G.tijian_hospital_id LIKE CONCAT('%',
				#{tijianHospitalId}, '%')
			</if>
			<if test="tool!=null">
				AND G.tool=#{tool}
			</if>
			<if test="insurance!=null">
				AND G.insurance=#{insurance}
			</if>
			<if test="must!=null">
				AND G.must=#{must}
			</if>
			<if test="type!=null">
				AND G.type=#{type}
			</if>
			<if test="gradeType!=null">
				AND G.grade_type=#{gradeType}
			</if>
			<if test="sort!=null">
				AND G.sort=#{sort}
			</if>
			<if test="remark!=null and remark!=''">
				AND G.remark LIKE CONCAT('%', #{remark}, '%')
			</if>
			<if test="status!=null">
				AND G.status=#{status}
			</if>
			<if test="createTime!=null">
				AND G.create_time=#{createTime}
			</if>
			<if test="creatorId!=null and creatorId!=''">
				AND G.creator_id LIKE CONCAT('%', #{creatorId}, '%')
			</if>
			<if test="creatorName!=null and creatorName!=''">
				AND G.creator_name LIKE CONCAT('%', #{creatorName}, '%')
			</if>
		</where>
	</sql>

	<sql id="dynamicSet">
		<set>
			<if test="id!=null">
				G.id=#{id},
			</if>
			<if test="productId!=null">
				G.product_id=#{productId},
			</if>
			<if test="title!=null">
				G.title=#{title},
			</if>
			<if test="subTitle!=null">
				G.sub_title=#{subTitle},
			</if>
			<if test="content!=null">
				G.content=#{content},
			</if>
			<if test="tijianTypeId!=null">
				G.tijian_type_id=#{tijianTypeId},
			</if>
			<if test="tijianHospitalId!=null">
				G.tijian_hospital_id=#{tijianHospitalId},
			</if>
			<if test="tool!=null">
				G.tool=#{tool},
			</if>
			<if test="insurance!=null">
				G.insurance=#{insurance},
			</if>
			<if test="must!=null">
				G.must=#{must},
			</if>
			<if test="type!=null">
				G.type=#{type},
			</if>
			<if test="gradeType!=null">
				G.grade_type=#{gradeType},
			</if>
			<if test="sort!=null">
				G.sort=#{sort},
			</if>
			<if test="remark!=null">
				G.remark=#{remark},
			</if>
			<if test="status!=null">
				G.status=#{status},
			</if>
			<if test="createTime!=null">
				G.create_time=#{createTime},
			</if>
			<if test="creatorId!=null">
				G.creator_id=#{creatorId},
			</if>
			<if test="creatorName!=null">
				G.creator_name=#{creatorName},
			</if>
		</set>
	</sql>

	<sql id="orderby">
		<if test="orderby != null">
			ORDER BY ${orderby}
		</if>
	</sql>

	<resultMap id="goods" type="com.jinpaihushi.jphs.goods.model.Goods">
		<result property="id" column="id" javaType="String" jdbcType="VARCHAR"></result>
		<result property="productId" column="product_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="title" column="title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="subTitle" column="sub_title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="content" column="content" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="tijianTypeId" column="tijian_type_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tijianHospitalId" column="tijian_hospital_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tool" column="tool" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="insurance" column="insurance" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="must" column="must" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="type" column="type" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="gradeType" column="gradeType" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="sort" column="sort" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="remark" column="remark" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="status" column="status" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="createTime" column="create_time" javaType="Date"
			jdbcType="TIMESTAMP"></result>
		<result property="creatorId" column="creator_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="creatorName" column="creator_name" javaType="String"
			jdbcType="VARCHAR"></result>
	</resultMap>

	<resultMap id="goodsDetail" type="com.jinpaihushi.jphs.goods.model.Goods">
		<result property="id" column="id" javaType="String" jdbcType="VARCHAR"></result>
		<result property="productId" column="product_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="title" column="title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="subTitle" column="sub_title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="content" column="content" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="tijianTypeId" column="tijian_type_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tijianHospitalId" column="tijian_hospital_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tool" column="tool" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="insurance" column="insurance" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="must" column="must" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="type" column="type" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="gradeType" column="grade_type" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="sort" column="sort" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="remark" column="remark" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="status" column="status" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="createTime" column="create_time" javaType="Date"
			jdbcType="TIMESTAMP"></result>
		<result property="creatorId" column="creator_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="creatorName" column="creator_name" javaType="String"
			jdbcType="VARCHAR"></result>
		<association property="Product"
			javaType="com.jinpaihushi.jphs.product.model.Product">
			<result property="id" column="product_id" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="title" column="product_title" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="sort" column="product_sort" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="status" column="product_status" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="remark" column="product_remark" javaType="String"
				jdbcType="VARCHAR"></result>
		</association>
		<collection property="serviceImagesList"
			ofType="com.jinpaihushi.jphs.service.model.ServiceImages">
			<result property="id" column="service_id" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="sourceId" column="source_id" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="url" column="url" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="path" column="path" javaType="String"
				jdbcType="CHAR"></result>
			<result property="device_type" column="device_type" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="type" column="service_type" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="sort" column="service_sort" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="remarks" column="service_remarks" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="status" column="service_status" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="createTime" column="service_create_time"
				javaType="Date" jdbcType="TIMESTAMP"></result>
			<result property="creatorId" column="service_creator_id"
				javaType="String" jdbcType="VARCHAR"></result>
			<result property="creatorName" column="service_creator_name"
				javaType="String" jdbcType="VARCHAR"></result>
		</collection>
	</resultMap>

	<resultMap id="goodsImgDetail" type="com.jinpaihushi.jphs.goods.model.Goods">
		<result property="id" column="id" javaType="String" jdbcType="VARCHAR"></result>
		<result property="productId" column="product_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="title" column="title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="subTitle" column="sub_title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="content" column="content" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="tijianTypeId" column="tijian_type_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tijianHospitalId" column="tijian_hospital_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tool" column="tool" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="insurance" column="insurance" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="must" column="must" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="type" column="type" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="gradeType" column="gradeType" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="sort" column="sort" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="remark" column="remark" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="status" column="status" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="createTime" column="create_time" javaType="Date"
			jdbcType="TIMESTAMP"></result>
		<result property="creatorId" column="creator_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="creatorName" column="creator_name" javaType="String"
			jdbcType="VARCHAR"></result>
		<collection property="serviceImagesList"
			ofType="com.jinpaihushi.jphs.service.model.ServiceImages">
			<result property="id" column="service_id" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="sourceId" column="source_id" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="url" column="url" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="path" column="path" javaType="String"
				jdbcType="CHAR"></result>
			<result property="device_type" column="device_type" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="type" column="service_type" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="sort" column="service_sort" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="remarks" column="service_remarks" javaType="String"
				jdbcType="VARCHAR"></result>
			<result property="status" column="service_status" javaType="Integer"
				jdbcType="INTEGER"></result>
			<result property="createTime" column="service_create_time"
				javaType="Date" jdbcType="TIMESTAMP"></result>
			<result property="creatorId" column="service_creator_id"
				javaType="String" jdbcType="VARCHAR"></result>
			<result property="creatorName" column="service_creator_name"
				javaType="String" jdbcType="VARCHAR"></result>
		</collection>
	</resultMap>

	<resultMap id="goodsGlobal" type="com.jinpaihushi.jphs.goods.model.Goods">
		<result property="id" column="G_id" javaType="String" jdbcType="VARCHAR"></result>
		<result property="productId" column="G_product_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="title" column="G_title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="subTitle" column="G_sub_title" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="content" column="G_content" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="tijianTypeId" column="G_tijian_type_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tijianHospitalId" column="G_tijian_hospital_id"
			javaType="String" jdbcType="VARCHAR"></result>
		<result property="tool" column="G_tool" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="insurance" column="G_insurance" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="must" column="G_must" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="type" column="G_type" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="gradeType" column="G_gradeType" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="sort" column="G_sort" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="remark" column="G_remark" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="status" column="G_status" javaType="Integer"
			jdbcType="INTEGER"></result>
		<result property="createTime" column="G_create_time" javaType="Date"
			jdbcType="TIMESTAMP"></result>
		<result property="creatorId" column="G_creator_id" javaType="String"
			jdbcType="VARCHAR"></result>
		<result property="creatorName" column="G_creator_name"
			javaType="String" jdbcType="VARCHAR"></result>
	</resultMap>

	<insert id="insert" useGeneratedKeys="true" keyProperty="id"
		parameterType="com.jinpaihushi.jphs.goods.model.Goods">
		INSERT INTO `GOODS`(
		id, product_id,
		title, sub_title,
		content, tijian_type_id,
		tijian_hospital_id, tool,
		insurance,must, type, grade_type,
		sort, remark,
		status, create_time,
		creator_id, creator_name
		)VALUES(
		#{id,jdbcType=VARCHAR}, #{productId,jdbcType=VARCHAR},
		#{title,jdbcType=VARCHAR}, #{subTitle,jdbcType=VARCHAR},
		#{content,jdbcType=VARCHAR}, #{tijianTypeId,jdbcType=VARCHAR},
		#{tijianHospitalId,jdbcType=VARCHAR}, #{tool,jdbcType=INTEGER},
		#{insurance,jdbcType=INTEGER},#{must,jdbcType=INTEGER},
		#{type,jdbcType=INTEGER}, #{gradeType,jdbcType=INTEGER},
		#{sort,jdbcType=INTEGER}, #{remark,jdbcType=VARCHAR},
		#{status,jdbcType=INTEGER}, now(),
		#{creatorId,jdbcType=VARCHAR}, #{creatorName,jdbcType=VARCHAR}
		)
	</insert>

	<insert id="inserts" useGeneratedKeys="false" parameterType="list">
        <![CDATA[
        INSERT INTO `GOODS`(
			id, product_id, 
			title, sub_title, 
			content, tijian_type_id, 
			tijian_hospital_id, tool, 
			insurance, must,type, grade_type,
			sort, remark, 
			status, create_time, 
			creator_id, creator_name
        )]]>
		VALUES
		<foreach collection="list" item="item" index="index"
			separator=",">
			(
			#{item.id,jdbcType=VARCHAR},
			#{item.productId,jdbcType=VARCHAR},
			#{item.title,jdbcType=VARCHAR}, #{item.subTitle,jdbcType=VARCHAR},
			#{item.content,jdbcType=VARCHAR}, #{item.tijianTypeId,jdbcType=VARCHAR},
			#{item.tijianHospitalId,jdbcType=VARCHAR},
			#{item.tool,jdbcType=INTEGER},
			#{item.insurance,jdbcType=INTEGER},#{item.must,jdbcType=INTEGER},
			#{item.type,jdbcType=INTEGER},#{item.gradeType,jdbcType=INTEGER},
			#{item.sort,jdbcType=INTEGER}, #{item.remark,jdbcType=VARCHAR},
			#{item.status,jdbcType=INTEGER},
			#{item.createTime,jdbcType=TIMESTAMP},
			#{item.creatorId,jdbcType=VARCHAR},
			#{item.creatorName,jdbcType=VARCHAR}
			)
		</foreach>
	</insert>

	<delete id="deleteById">
		DELETE G FROM `GOODS` G WHERE G.ID = #{id}
	</delete>

	<update id="disableById">
		UPDATE `GOODS` G
		SET
		G.STATUS = -1
		WHERE G.ID = #{id}
	</update>

	<update id="update">
		UPDATE `GOODS` G
		<include refid="dynamicSet" />
		WHERE G.ID = #{id}
	</update>

	<select id="load" resultMap="goods">
		SELECT
		<include refid="field" />
		FROM `GOODS` G
		<include refid="dynamicWhere" />
	</select>

	<select id="count" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM `GOODS` G
		<include refid="dynamicWhere" />
	</select>

	<select id="list" resultMap="goods">
		SELECT
		<include refid="field" />
		FROM `GOODS` G
		<include refid="dynamicWhere" />
		<include refid="orderby" />
	</select>

	<select id="query" resultMap="goods">
		SELECT
		<include refid="field" />
		FROM `GOODS` G
		<include refid="dynamicWhere" />
		<include refid="orderby" />
	</select>

	<select id="loadById" resultMap="goods">
		SELECT
		<include refid="field" />
		FROM `GOODS` G
		WHERE G.ID = #{id}
	</select>

	<select id="getGoodsDetail" resultMap="goodsDetail">
		SELECT
		s.id,
		s.title,
		s.sub_title,
		s.product_id,
		s.content,
		s.tool,
		s.insurance,
		s.tijian_type_id,
		s.tijian_hospital_id,
		s.must,
		s.type,
		s.grade_type,
		s.sort,
		s.status,
		s.remark,
		s.create_time,
		s.creator_id,
		s.creator_name,
		i.id service_id,
		i.source_id,
		i.url,
		i.path,
		i.device_type,
		i.type service_type,
		i.sort service_sort,
		i.remarks service_remark,
		i.status service_status,
		i.create_time service_create_time,
		i.creator_id service_creator_id,
		i.creator_name service_creator_name,
		p.id product_id,
		p.title product_title,
		p.sort product_sort,
		p.status product_status,
		p.remark product_remark
		FROM
		goods s
		LEFT JOIN `service_images` i ON i.source_id = s.id
		LEFT JOIN `product` p ON p.id = s.product_id
		WHERE s.id = #{id} ORDER BY s.sort;
	</select>

	<select id="getGoodsImgDetail" resultMap="goodsImgDetail">
		SELECT
		s.id,
		s.title,
		s.sub_title,
		s.product_id,
		s.content,
		s.tool,
		s.insurance,
		s.tijian_type_id,
		s.tijian_hospital_id,
		s.must,
		s.type,
		s.grade_type,
		s.sort,
		s.status,
		s.remark,
		s.create_time,
		s.creator_id,
		s.creator_name,
		i.id service_id,
		i.source_id,
		i.url,
		i.path,
		i.device_type,
		i.type service_type,
		i.sort service_sort,
		i.remarks service_remark,
		i.status service_status,
		i.create_time service_create_time,
		i.creator_id service_creator_id,
		i.creator_name service_creator_name,
		FROM
		goods s
		LEFT JOIN `service_images` i ON i.source_id = s.id
		WHERE
		s.id = #{id} ORDER BY s.create_time desc;
	</select>
	<select id="getGoodsByPricePart" resultMap="goods">
		SELECT
		g.*
		FROM
		price_part pp
		LEFT JOIN price p ON pp.price_id = p.id
		LEFT JOIN goods g ON p.goods_id =g.id
		WHERE pp.id = #{pricePartId}
	</select>
</mapper>
